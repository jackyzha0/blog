<!doctype html><html><head><link rel=preconnect href=https://www.googletagmanager.com><link crossorigin rel=preconnect href=https://www.google-analytics.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-148413215-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-148413215-1');</script><meta charset=utf-8><meta name=description content="jacky zhao personal portfolio - software developer trying to build solutions to the world’s problems"><meta name=viewport content="width=device-width,initial-scale=1"><link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Mono:wght@700&display=swap" rel=stylesheet><style>:root{--light: #fbfffe;--lightgray: #f0f0f0;--gray: #dddddd;--p: #606060;--dark: #284b63;--secondary: #84a59d}.hover{color:var(--dark);text-decoration:none;display:inline-block;position:relative;opacity:.6;z-index:1}.hover::after{transition:300ms;height:20px;content:"";position:absolute;background-color:var(--secondary);opacity:.5;z-index:-1;width:0%;left:15px;bottom:0}header,.singlePost,#postTitle{display:flex;flex-direction:row;align-items:center;justify-content:space-between}#postTitle h1{margin-right:4em}header:hover .hover{opacity:1}header:hover .hover::after{width:100%}body{margin:0;background-color:var(--light)}.desc{flex:1}.desc *{display:inline-block}footer{margin-top:4em;text-align:center}.meta{margin-left:2em!important}#contentWrapper{margin:25px 25vw}@media all and (max-width:900px){#contentWrapper{margin:25px 5vw}}@media all and (max-width:600px){nav{display:none}}table{width:100%}img{width:100%;border-radius:3px;margin:2em 0}strong{color:#000}</style><style>.singlePost *{margin:.1em auto}h1,h2,h3,h4,a,.time,ol,ul,thead{font-family:Roboto Mono}a{text-decoration:none;color:var(--dark);transition:all .2s ease}#posts{list-style:none;padding:0;margin:0}p,tbody{font-family:Roboto;color:var(--p);line-height:1.5em}h2{opacity:.85}h3{opacity:.75}blockquote{margin-left:1em;border-left:3px solid var(--secondary);padding-left:1em}pre{font-family:Roboto Mono;padding:.75em;border-radius:3px}table{padding:1.5em}td,th{padding:.1em .5em}</style><style>.chroma{color:#272822;background-color:#fafafa}.chroma .err{color:#960050;background-color:#1e0010}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#00a8c8}.chroma .kc{color:#00a8c8}.chroma .kd{color:#00a8c8}.chroma .kn{color:#f92672}.chroma .kp{color:#00a8c8}.chroma .kr{color:#00a8c8}.chroma .kt{color:#00a8c8}.chroma .n{color:#111}.chroma .na{color:#75af00}.chroma .nb{color:#111}.chroma .bp{color:#111}.chroma .nc{color:#75af00}.chroma .no{color:#00a8c8}.chroma .nd{color:#75af00}.chroma .ni{color:#111}.chroma .ne{color:#75af00}.chroma .nf{color:#75af00}.chroma .fm{color:#111}.chroma .nl{color:#111}.chroma .nn{color:#111}.chroma .nx{color:#75af00}.chroma .py{color:#111}.chroma .nt{color:#f92672}.chroma .nv{color:#111}.chroma .vc{color:#111}.chroma .vg{color:#111}.chroma .vi{color:#111}.chroma .vm{color:#111}.chroma .l{color:#ae81ff}.chroma .ld{color:#d88200}.chroma .s{color:#d88200}.chroma .sa{color:#d88200}.chroma .sb{color:#d88200}.chroma .sc{color:#d88200}.chroma .dl{color:#d88200}.chroma .sd{color:#d88200}.chroma .s2{color:#d88200}.chroma .se{color:#8045ff}.chroma .sh{color:#d88200}.chroma .si{color:#d88200}.chroma .sx{color:#d88200}.chroma .sr{color:#d88200}.chroma .s1{color:#d88200}.chroma .ss{color:#d88200}.chroma .m{color:#ae81ff}.chroma .mb{color:#ae81ff}.chroma .mf{color:#ae81ff}.chroma .mh{color:#ae81ff}.chroma .mi{color:#ae81ff}.chroma .il{color:#ae81ff}.chroma .mo{color:#ae81ff}.chroma .o{color:#f92672}.chroma .ow{color:#f92672}.chroma .p{color:#111}.chroma .c{color:#75715e}.chroma .ch{color:#75715e}.chroma .cm{color:#75715e}.chroma .c1{color:#75715e}.chroma .cs{color:#75715e}.chroma .cp{color:#75715e}.chroma .cpf{color:#75715e}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style></head><body><div id=contentWrapper><header><h1><a class=hover href=/>jzhao.xyz</a></h1><nav><a target=_blank href=https://jzhao.xyz>[site]</a>
<a target=_blank href=https://github.com/jackyzha0>[github]</a>
<a target=_blank href=https://twitter.com/_jzhao>[twitter]</a></nav></header><main><article><div id=postTitle class=desc><h1>reflect: NLP model explained pt.1</h1><p>written May 10, 2020 // 2001 words</p></div><div id=mainText><p><img src=https://miro.medium.com/max/1400/1*yjCs2Mmcve8wNI1pdfXelw.png alt="An image of the reflect block page"><em>How do we tell that this is a “valid” intent?</em></p><p>A (not so) brief exploration of how we tackle classifying intents in reflect. Part 1 will touch on defining the problem we’re trying to solve, the data we have, and how we pre-processed it. Part 2 will focus on the architecture of the model we built, how well it does, and thoughts on improving it for the future.</p><h2 id=the-problem>The problem</h2><p>Classifying intents is at the core of reflect. When a user inputs an intent, its reflect’s job to figure out whether that intent should let them into the website.</p><blockquote><p>How do we make sure “do some marketing work for reflect” is classified as productive but “watch cute dog videos” isn’t?</p></blockquote><h2 id=why-its-so-difficult>Why it’s so difficult</h2><p>A lot of it comes down to the fact that natural language processing (NLP) is a very difficult task. What does the sentence “learn about physics” mean, and how is it semantically different from “asdflkj I can’t do work”?</p><p>We can’t just parse for keywords and just allow a user in if we see the word “work” because that word can mean different things in different contexts. For example, “I’m not doing any work right now” would have otherwise been classified as valid. Thus, we can employ the help of a machine learning algorithm to help us capture this deeper meaning.</p><p>Specifically, the form of machine learning we will be using is called **supervised learning, **in which we give an algorithm a bunch of labelled data, tell it what it’s doing wrong, and let it ‘learn.’ Through doing this, hopefully the algorithm will be able to generalize and make predictions on unseen data too.</p><h2 id=the-data>The data</h2><p>Of course, if we want to perform supervised learning, we’re going to need a lot of data. Where are we going to get all of it? Luckily, we were able to get it through 3 different sources.</p><h3 id=survey-data-444-entries>Survey data (444 entries)</h3><p>Our team sent out an interest survey in early January in which we asked 3 questions:</p><ol><li><p>How would you answer if you were trying to visit a distracting site while trying to focus? (eg. youtube, facebook, etc)</p></li><li><p>How would you answer if you were trying to visit a distracting site to take a quick break from your work? (eg. youtube, facebook, etc)</p></li><li><p>How would you answer if you were trying to visit a distracting site like Facebook but to do work? (e.g. make a marketing post)</p></li></ol><p>We used these answers to form the basis of our very first dataset. We ended up getting a surprising amount of entries, ending with 148 responses to 3 questions and totalling 444 different observations. Here’s what some of that data looks like after tidying it up:</p><blockquote><p>We classified any answer to Q1 as invalid and Q2 + Q3 as valid</p></blockquote><table><thead><tr><th>intent</th><th>valid</th></tr></thead><tbody><tr><td>I am watching a 5 minute video to take my mind off not being productive :/</td><td>no</td></tr><tr><td>I&rsquo;m just bored</td><td>no</td></tr><tr><td>I’m bored/tired and trying to relax</td><td>no</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>work is pretty boring, i need to take a quick break I just can&rsquo;t focus atm</td><td>yes</td></tr><tr><td>I finished all my work for today so I&rsquo;m going to take a break now!</td><td>yes</td></tr><tr><td>getting some advertising done for my club</td><td>yes</td></tr><tr><td>I need to make a post on Twitter for my job announcing the latest update to our site</td><td>yes</td></tr><tr><td>I&rsquo;m trying to network</td><td>yes</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><h3 id=closed-beta-790-entries>Closed Beta (790 entries)</h3><p>After we made a basic dataset, we were able to make our first (admittedly not great) model. But in doing so, this let us create an MVP to which we could use to actually test with. We then deployed this model for use to our closed beta testers and collected their responses (with consent of course!) along with the website it was input on. This was then converted into a .csv file. A few examples are show below:</p><table><thead><tr><th>intent</th><th>url</th></tr></thead><tbody><tr><td>to do some marketing</td><td>facebook.com/</td></tr><tr><td>i cannot focus on my work</td><td>instagram.com/</td></tr><tr><td>fuel my crippling social media addiction</td><td>facebook.com/</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p>These were then hand-labelled by our reflect team in a similar format as the survey data we collected earlier.</p><table><thead><tr><th>intent</th><th>valid</th></tr></thead><tbody><tr><td>to do some marketing</td><td>yes</td></tr><tr><td>i cannot focus on my work</td><td>no</td></tr><tr><td>fuel my crippling social media addiction</td><td>no</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><h3 id=closed-beta-corrections-37-entries>Closed Beta Corrections (37 entries)</h3><p>Finally, we created a Google Forms through which we directly asked beta testers if a decision made by reflect’s intent classifier was faulty. Specifically, we asked what they input, and what they expected. Here are a few examples:</p><table><thead><tr><th>input</th><th>valid</th></tr></thead><tbody><tr><td>reply to a friend about a lab</td><td>yes</td></tr><tr><td>listening to a youtube music playlist</td><td>yes</td></tr><tr><td>goof off as much as possible</td><td>yes</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p>This entire section of the dataset was only 37 observations, but it drastically helped us reduce false positives and false negatives by focusing specifically on misclassifications.</p><p>After aggregating and combing all our data into one common format, we ended up with a grand total of 1271 observations. They looked something like this:</p><table><thead><tr><th>input</th><th>expected</th></tr></thead><tbody><tr><td>fail school by watching youtube</td><td>no</td></tr><tr><td>sdlkjasd</td><td>no</td></tr><tr><td>making a quick product post (should take &lt;10 min)</td><td>yes</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><h3 id=so>So?</h3><p>Now that we have the data, can we just throw it into a machine learning model? Unfortunately, the answer is no, not quite yet.</p><h2 id=data-augmentation>Data augmentation</h2><p>Our dataset is still pretty small, even after aggregating all of our data. It most definitely doesn’t cover all of our bases for all the possible things that future users could possibly input. So, how can we “upsample” our data to get more of it? Well, it turns out that the field of Natural Language Processing has quite a few tricks to augment our data.</p><h3 id=sentence-variation>Sentence Variation</h3><p>Essentially what sentence variation is, is just replacing a few words of given sentences with their synonyms. If we have a sentence like “I’m trying to make a marketing post,” we can swap out singular words with their synonyms and tell our network that it means the same thing.</p><p>In this example, we could get something like “I’m attempting to fabricate a marketing post”. Adding these additional sentence variations will allow our machine learning model to learn semantic relationships between similar words (e.g. fabricate and make have similar meaning)</p><h3 id=sentence-negation>Sentence Negation</h3><p>Additionally, if we add a ‘not’ in the sentence, it should flip the meaning of the sentence. An example would be “learning about physics” is valid, whereas “not learning about physics” is not. However, if the sentence already contains ‘not’ (e.g. “I’m not being productive”), adding another ‘not’ would make the sentence too complex and obfuscated, so we just label it as invalid. In essence, we just add ‘not’ to a bunch of sentences and label them as invalid. This helps us to combat intents which use negations in a sort of round-a-bout way to confuse the algorithm.</p><h3 id=shuffled-sentences>Shuffled Sentences</h3><p>If we take an existing, valid sentence and completely shuffle the words, the resulting sentence should be invalid. An example would be “to watch a crash course video*” should be valid whereas “video course a watch crash to*” should be invalid. Basically, we’re just shuffling existing sentences and also labelling them as invalid. This helps us to combat intents which grammatically make no sense, but are otherwise valid.</p><h3 id=garbage-sentences>Garbage Sentences</h3><p>We can also take completely random words from the English language and put them together. The resulting sentences should all be invalid. For example, “*untinkered phalangitis shaly quinovic dish spadiciflorous unshaved” *clearly makes no sense. However, the addition of these gibberish sentences allows our model to be more robust against foreign words and out-of-vocabulary terms.</p><h3 id=vocabulary-mix-sentences>Vocabulary-mix Sentences</h3><p>Last but definitely not least, we can take the most common words in our dataset and mash them together. This should yield us a bunch of sentences which contain “key words” but should be marked as invalid because the context in which they are used makes no sense. For example, “video look watching” and “get research facebook take need want need message watch” are both clearly gibberish sentences, but they have a lot of keywords that one would think would let you in (e.g. video, research, watching, etc.). This lets us be more robust against those who try to get around the algorithm using keywords.</p><h2 id=data-preprocessing>Data preprocessing</h2><p>What about now? Can we throw it into the neural network yet? Well, no. We may have increased the amount of data we have to work with, but we also need to convert it to a form that is easy to understand for both the computer and for our algorithm. We do that with a series of functions that we apply on our data.</p><h3 id=strip-punctuation>Strip punctuation</h3><p>As the name suggests, we remove all punctuation from the input phrase. We found that including the punctuation hurt our performance, most likely due to the fact that they offer very little in terms of semantic meaning and obfuscate the real meaning of the sentence.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>stripPunctuation</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>I don</span><span class=s2>&#39;</span><span class=s2>t know if I</span><span class=s2>&#39;</span><span class=s2>m being productive! :(</span><span class=s2>&#34;</span><span class=p>)</span> 
<span class=o>&gt;</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>I dont know if Im being productive</span><span class=s2>&#34;</span>
</code></pre></div><h3 id=make-everything-lowercase>Make everything lowercase</h3><p>Additionally, we found that in this particular setting, capital letters also didn’t matter that much. Because of the nature we collect our data (just a simple textbox), users tend to not bother with capitalization. As such, we remove it to make it consistent across our data.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>lower</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>I dont know if Im being productive</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=o>&gt;</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>i dont know if im being productive</span><span class=s2>&#34;</span>
</code></pre></div><h3 id=expand-contractions>Expand contractions</h3><p>The English language does this weird thing where we can just smush two words together (e.g. “I am” to “I’m”). Unfortunately for us, these produce extra complexity in our model that we could reduce by making them all consistent. In our case, we chose to expand all of these contractions.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>expandContractions</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>i dont know if im being productive</span><span class=s2>&#34;</span><span class=p>)</span> 
<span class=o>&gt;</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>i do not know if i am being productive</span><span class=s2>&#34;</span>
</code></pre></div><h3 id=remove-stop-words>Remove stop words</h3><p>The English language also has a bunch of these things called **stop words — **words that do not contribute anything major to the sentence in terms of semantic understanding (usually in the context of natural language tasks such as this). A few examples of them are ‘I’, ‘me’, ‘my’, ‘by’, and ‘on’. By removing them, we once again remove unneeded complexity from the model.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>rmStopwords</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>i do not know if i am being productive</span><span class=s2>&#34;</span><span class=p>)</span> 
<span class=o>&gt;</span> <span class=sa></span><span class=s2>&#34;</span><span class=s2>not know productive</span><span class=s2>&#34;</span>
</code></pre></div><h3 id=tokenization>Tokenization</h3><p>However, these words are not super friendly for machine learning algorithms who would much rather deal with integers and floating point numbers than words and sentences. How do we fix this?</p><p>Well, one thing we can do is turn words in indices by how often they appear, capped at the most common 1000 words — in essence, creating a vocabulary list mapping common words to numbers. For example, if “the” is the most common word, we convert it to 1. If “work” is the 8th most common word, we convert it to 8. For anything that isn’t in the top 1000, we give it the value of 0.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>tokenize</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>not know productive</span><span class=s2>&#34;</span><span class=p>)</span> 
<span class=o>&gt;</span> <span class=p>[</span><span class=mi>12</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>7</span><span class=p>]</span>
</code></pre></div><h3 id=fixed-sequence-length>Fixed sequence length</h3><p>Finally, we need to ensure that all the inputs are the same length of simplicity sake. If we were to handle dynamic length inputs, it would introduce a whole other level of complexity that we’re really not ready to deal with. As such, we can make sure all the inputs are the same length by adding a bunch of zeros to those who are too short (zero padding) or by slicing those who are too long.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>pad</span><span class=p>(</span><span class=p>[</span><span class=mi>12</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>7</span><span class=p>]</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> 
<span class=o>&gt;</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>7</span><span class=p>]</span>
</code></pre></div><h3 id=finally>Finally</h3><p>After all of these functions have been applied, we have successfully converted a complex sentence into a series of ‘tokens’ that is easy to understand for the machine learning algorithm.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>preprocess</span><span class=p>(</span><span class=sa></span><span class=s2>&#34;</span><span class=s2>I don’t know if I’m being productive! :(</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=o>&gt;</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>7</span><span class=p>]</span>
</code></pre></div><h2 id=whats-next>What’s next?</h2><p>Now that we have something ready to feed into our neural network, let’s dive into how the actual model itself works!</p><p><a href=/posts/reflect-nlp-2>Read Part 2</a></p></div></article></main><footer><p>made by jacky zhao, © 2020</p><a href=https://github.com/jackyzha0/blog target=_blank>[source]</a></footer></div></body></html>